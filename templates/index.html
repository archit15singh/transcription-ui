<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player with Transcription</title>
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.png') }}">
</head>
<body>
    <div>
        <audio controls id="audioPlayer">
            <source src="{{ url_for('static', filename='audio/conversation.mp3') }}" type="audio/mp3">
            Your browser does not support the audio element.
        </audio>
    </div>
    <div>
        <ul id="transcriptionList"></ul>
    </div>

    <script>
        fetch('/get_transcription')
            .then(response => response.json())
            .then(data => {
                const transcriptionList = document.getElementById('transcriptionList');
                data.forEach(entry => {
                    const listItem = document.createElement('li');
                    const from = entry.timestamps.from.split(',')[0];
                    const to = entry.timestamps.to.split(',')[0];
                    listItem.textContent = `${from} - ${to} - ${entry.text}`;
                    transcriptionList.appendChild(listItem);
                });

                // Add event listener to highlight corresponding transcription on audio time update
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.addEventListener('timeupdate', function () {
                    const currentTime = audioPlayer.currentTime;
                    transcriptionList.childNodes.forEach((item, index) => {
                        const startTime = parseTimestamp(data[index].timestamps.from);
                        const endTime = parseTimestamp(data[index].timestamps.to);
                        
                        if (currentTime >= startTime && currentTime < endTime) {
                            item.style.backgroundColor = 'yellow'; // Highlight the current transcription
                        } else {
                            item.style.backgroundColor = ''; // Remove highlight
                        }
                    });
                });

                // Helper function to convert timestamp to seconds
                function parseTimestamp(timestamp) {
                    const parts = timestamp.split(':');
                    const seconds = parseFloat(parts[0]) * 60 * 60 + parseFloat(parts[1]) * 60 + parseFloat(parts[2]);
                    return seconds;
                }
            });
    </script>
</body>
</html>
